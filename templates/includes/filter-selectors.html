<!-- FILTER SELECTOR INCLUDE -->
<div id="filter_selectors_wrapper" class="parent">
    <div class="left-align">
        <div class="autocomplete" style="width:400px;">
            <input  class="studyprogram" id="studyprogram_input" type="text" name="studyprogram" placeholder="Studienprogramm">
            <!-- <button class="studyprogram btn" id="studyprogram_btn" onclick="ShowSelectedModules()">Filtern</button> -->
            <button class="studyprogram btn" id="studyprogram_btn_clear" onclick="ClearStudyProgramFilter()">Filter löschen</button>
        </div>
    </div>

    <div id="filter_selectors" class="right-align">
        <select name="semester" id="semester_selector">
            <option value="all_years all_semesters" id="all_semesters">Alle Semester</option>>
            {% for sesh in sessions %}
            <option value="{{sesh['year']}} {{sesh['session']}}" id="{{sesh['year']}} {{sesh['session']}}" {% if loop.index == 2 %} selected {% endif %}>
                {% if sesh['session'] == 3 %} Herbstsemester {{sesh['year']}} 
                {% else %} Frühlingssemester {{sesh['year']+1}}{% endif %} 
            </option>
            {% endfor %}       
        </select>
    </div>
    <div class="spacer" style="height: 3em">
    <!--hwat-->
    <script type="text/javascript" src="static/filter.js"></script>
    <!-- <script type="text/javascript" src="static/additional/autocomplete.js"></script> -->
    <script type="text/javascript">
        $('select#semester_selector').change(function() {
            ClearStudyProgramFilter();
            ShowSelectedModules();
            populate_studyprograms();
        });
        {% if studyprograms is not none %}   
            studyprograms = {{studyprograms | safe}}
        {% endif %}
        studyprogramid_moduleids = {}
        {% if studyprogramid_moduleids is not none %}   
            studyprogramid_moduleids = {{studyprogramid_moduleids | safe}}
        {% endif %}
        $('#studyprogram_input').autocomplete({
            source: studyprogram_textlist,
            minLength: 0,
        }).focus(function() {
            $(this).autocomplete('search', $(this).val())
        });
        function autocomplete_noresults() {
            var sp_suggestions_container = document.getElementById('studyprogram_inputautocomplete-list');
            if(sp_suggestions_container) {
                var n_sp_suggestions = sp_suggestions_container.childElementCount;
                if (n_sp_suggestions===0) {
                    no_modules_item = document.createElement("DIV");
                    no_modules_item.innerHTML = "Keine Studienprogramme für Module dieses Semesters gefunden.";
                    sp_suggestions_container.appendChild(no_modules_item);
                }
            }
        }
        $('#studyprogram_input').on('input',function(e){
            autocomplete_noresults();
        });
        function monkeyPatchAutocomplete() {
            $.ui.autocomplete.prototype._renderItem = function (ul, item) {

                // Escape any regex syntax inside this.term
                var cleanTerm = this.term.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');

                // Build pipe separated string of terms to highlight
                var keywords = $.trim(cleanTerm).replace('  ', ' ').split(' ').join('|');

                // Get the new label text to use with matched terms wrapped
                // in a span tag with a class to do the highlighting
                var re = new RegExp("(" + keywords + ")", "gi");
                var output = item.label.replace(re,  
                    '<span class="ui-menu-item-highlight">$1</span>');

                return $("<li>")
                    .append($("<a>").html(output))
                    .appendTo(ul);
            };
        };

        $(function () {
        monkeyPatchAutocomplete();
        });
    </script>
    <link rel="stylesheet" href="static/filter.css">
</div>
<!-- END FILTER SELECTOR INCLUDE -->
